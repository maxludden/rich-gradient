# rich-gradient Copilot Instructions

## Big Picture
- Core renderables live in `src/rich_gradient`: `text.py` subclasses `rich.text.Text`, while `gradient.py` wraps any Rich renderable to inject per-character gradients and highlighting. Panels, rules, markdown, and animated variants all build on this base.
- Animated components (`animated_gradient.py`, `animated_panel.py`, etc.) wrap `rich.live.Live`; they consult `config.animation_enabled`, so keep config wiring intact when touching animation flags.
- The CLI has two layers: a Click-based legacy command set in `src/rich_gradient/cli.py` and Typer helpers under `src/rich_gradient/_cli/common.py` that normalize arguments and print themed help panels. Reuse those helpers whenever adding commands.
- Docs under `docs/` plus `mkdocs.yml` fuel the published site in `site/`. Reference these Markdown files for usage expectations and keep autogenerated assets in `docs/img/` or `static/`.

## Configuration & Data
- Runtime config (`src/rich_gradient/config.py`) merges defaults, `~/.rich-gradient/config.json`, and env vars like `RICH_GRADIENT_HOME_DIR` or `RICH_GRADIENT_COLORS`. When adding options, update `RichGradientConfig.DEFAULT_CONFIG` and ensure JSON + env overrides flow through `_deep_update`.
- Color palettes and example parameter grids live in `static/*.csv`. Tests and docs assume these files stay sorted and UTF-8; if you regenerate them, keep headers identical so scripts in `docs/scripts/` keep working.
- `rich_color_ext` auto-installs at import time (`__init__.py`). Avoid circular imports by guarding new top-level side effects.

## Coding Conventions
- Prefer Rich types (`Text`, `Panel`, `Align`) over manual ANSI strings. New renderables should accept either strings or `ConsoleRenderable` objects and normalize via `RichText.from_markup`, mirroring `panel.py`.
- When exposing styles/colors, allow CSS names, hex strings, tuples, or `rich.color.Color`. Reuse `Text._normalize_color` or `Gradient._to_color_triplets` rather than re-parsing.
- Highlight APIs accept both mappings and sequences; follow the `_ingest_init_highlight_*` patterns in `gradient.py` so tests in `tests/test_gradient.py` continue to pass.
- Keep gamma-correct interpolation (`_GAMMA_CORRECTION = 2.2`) untouched unless updating the entire gradient math; there are direct assertions around `_color_at` in the test suite.

## Developer Workflows
- Use uv for everything: `uv sync` to install, `uv run pytest` (or `uv run pytest -k gradient`) for tests, `uv run mkdocs serve` to preview docs, `uv build` for wheels.
- CLI smoke tests: `uv run python -m rich_gradient.cli print "hello" -c magenta,cyan` or `uv run python -m rich_gradient._cli.common` for Typer routing checks.
- Docs rely on generated SVGs (see `examples/` scripts). Update assets via the scripts before committing or CI will ship stale screenshots.

## Testing Expectations
- Unit tests live in `tests/`. `test_gradient.py` stresses interpolation boundaries, highlight layering, and justification; keep new features covered there.
- `test_config.py` reloads the package to ensure `config` picks up temp dirs. If you cache globals, provide hooks to refresh them or tests will fail.
- `test_animation.py`, `test_panel.py`, `test_markdown.py`, etc., record Rich output via `Console(record=True)`; avoid introducing nondeterministic timestamps or random seeds unless you gate them behind deterministic defaults.

## Collaboration Tips
- Update both `docs/*.md` and `examples/*.py` when changing public APIs so the CLI help and documentation screenshots stay aligned.
- When adding CLI flags, describe them in `docs/cli.md`, wire them through `_parse_colors/_parse_style` helpers in `cli.py`, and cover parsing edge cases in `tests/test_edge_cases.py`.
- Before merging, run `uv run pytest` and `uv run mkdocs build` locally; CI assumes both succeed without extra environment variables.
- Keep `.github` workflows minimalâ€”this repo currently relies on manual releases, so mention any new automation you add in PR descriptions.
